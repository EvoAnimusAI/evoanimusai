  # daemon/evoai_context.py                                  # -*- coding: utf-8 -*-
> """
> Contexto operativo central de EvoAI.
> Provee un marco simb贸lico, memoria, state y configuraci贸n,
> con trazabilidad exhaustiva para auditor铆a y monitoreo.
> Cumple est谩ndares gubernamentales de seguridad y control.
> """
  
! from typing import Optional, Dict, Any
! import datetime
! import logging
  
! from symbolic_ai.symbolic_learning_engine import SymbolicLearningEngine
! from core.memory import AgentMemory
! from core.config import Config
! from core.state_manager import StateManager
  
! logger = logging.getLogger("EvoAI.Context")
  
  
! class EvoAIContext:
!     """
!     Contexto global para la ejecuci贸n del agente EvoAI.
  
!     Componentes:
!       - Motor simb贸lico (SymbolicLearningEngine o compatible)
!       - Memoria (AgentMemory)
!       - Estado (StateManager)
!       - Configuraci贸n (Config)
  
!     Funcionalidades:
!       - Actualizaci贸n del contexto con validaci贸n y trazabilidad
!       - Registro expl铆cito de conceptos simb贸licos
!       - Exposition de state para auditor铆a
!     """
  
!     def __init__(
!         self,
!         symbolic_engine: Optional[Any] = None,
!         app_name: str = "EvoAI",
!         version: str = "1.0.0"
!     ):
!         """
!         Inicializa el contexto con par谩metros claros para configuraci贸n.
  
!         Args:
!             symbolic_engine: motor simb贸lico inyectable. Si es None, se usa SymbolicLearningEngine().
!             app_name (str): Nombre de la aplicaci贸n para Config.
!             version (str): Versi贸n de la aplicaci贸n para Config.
!         """
!         self.symbolic: SymbolicLearningEngine = (
!             symbolic_engine if symbolic_engine is not None
!             else SymbolicLearningEngine()
!         )
!         self.memory: AgentMemory = AgentMemory()
!         self.state: StateManager = StateManager()
!         self.config: Config = Config(app_name=app_name, version=version)
!         self.engine: Optional[Any] = None  # Motor asignable adicional
  
!         logger.info(f" EvoAIContext inicializado [{datetime.datetime.utcnow().isoformat()}]")
  
!     def update(self, observation: Dict[str, Any]) -> None:
!         """
!         Actualiza el contexto con una nueva observaci贸n.
  
!         Valida la estructura de la observaci贸n y registra evento.
!         Propaga la observaci贸n a los componentes internos.
!         """
!         if not isinstance(observation, dict):
!             logger.error(f"Observaci贸n inv谩lida (no dict): {observation}")
!             raise TypeError("La observaci贸n debe ser un diccionario v谩lido.")
  
!         try:
!             if self.symbolic:
!                 self.symbolic.observe(observation)
!             if self.state:
!                 self.state.update(observation)
!             logger.info(f"[Context] Observaci贸n registrada: {observation}")
!         except Exception as ex:
!             logger.exception(f"Error al actualizar contexto con la observaci贸n: {ex}")
!             raise
  
!     def add_concept(self, concept: str, source: str = "unknown") -> None:
!         """
!         Agrega un concepto simb贸lico al motor simb贸lico.
  
!         Valida par谩metros, registra evento y asegura trazabilidad.
!         """
!         if not isinstance(concept, str) or not concept.strip():
!             logger.error(f"Concepto inv谩lido para agregar: '{concept}'")
!             raise ValueError("Concepto debe ser una cadena no vac铆a.")
  
!         if self.symbolic:
!             try:
!                 if hasattr(self.symbolic, "register_concept"):
!                     self.symbolic.register_concept(concept.strip(), source)
!                 else:
!                     logger.warning("[Context] register_concept no implementado en SymbolicLearningEngine")
!                 logger.info(f"[Context] Concepto agregado: '{concept}' (fuente: {source})")
!             except Exception as ex:
!                 logger.exception(f"Error al agregar concepto '{concept}': {ex}")
!                 raise
  
!     def get_state_snapshot(self) -> Dict[str, Any]:
!         """
!         Obtiene una instant谩nea auditada del state actual del contexto.
  
!         Retorna:
!             Dict con states relevantes para monitoreo y auditor铆a.
!         """
!         try:
!             snapshot = {
!                 "timestamp_utc": datetime.datetime.utcnow().isoformat(),
!                 "symbolic_state": self.symbolic.export_state() if self.symbolic else None,
!                 "memory_summary": self.memory.summary() if self.memory else None,
!                 "state_status": self.state.status() if self.state and hasattr(self.state, "status") else None,
!                 "config_version": getattr(self.config, "version", "unknown"),
!             }
!             logger.debug(f"[Context] Snapshot state: {snapshot}")
!             return snapshot
!         except Exception as ex:
!             logger.exception(f"Error al obtener snapshot del state: {ex}")
!             raise
